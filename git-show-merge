#!/bin/bash -e

# TODO Allow passing in merge strategy
# TODO Optionally parse merge commit message for merge strategy
## e.g. Merge-strategy: octopus
## Issue: Merge strategies untracked
### Counterexample: .gitattributes can be tracked, but invokes untracked behavior

current_commit="$(git rev-parse HEAD)"
merge_commit="$(git rev-parse "$1")"

git stash -u
trap EXIT 'git reset --hard "$current_commit" && git stash pop'
git checkout "$merge_commit^"
git merge $(non-first-merge-parents "$merge_commit")
git commit -a --allow-empty{,-message}
git show "$(git commit-tree "$merge_commit" -p HEAD -C "$merge_commit")"
